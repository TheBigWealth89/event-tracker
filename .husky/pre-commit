#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color
BOLD='\033[1m'

# Function to print colored output
print_status() {
    printf "${2}${1}${NC}\n"
}

# Function to print step
print_step() {
    printf "\n${CYAN}${BOLD}▶ ${1}${NC}\n"
}

# Clear screen for clean output
clear

# Header
printf "\n"
printf "${PURPLE}${BOLD}╔════════════════════════════════════════╗${NC}\n"
printf "${PURPLE}${BOLD}║                                        ║${NC}\n"
printf "${PURPLE}${BOLD}║           PRE-COMMIT CHECKS            ║${NC}\n"
printf "${PURPLE}${BOLD}║                                        ║${NC}\n"
printf "${PURPLE}${BOLD}╚════════════════════════════════════════╝${NC}\n"
printf "\n"

# Track if any command fails
FAILED=0

# Run format check
print_step "Checking code formatting..."
if npm run format:check; then
    print_status "   ✅ Code formatting looks good!" "$GREEN"
else
    print_status "   ❌ Code formatting issues found!" "$RED"
    FAILED=1
fi

# Run typecheck
print_step "Running TypeScript type check..."
if npm run typecheck; then
    print_status "   ✅ No type errors found!" "$GREEN"
else
    print_status "   ❌ Type errors detected!" "$RED"
    FAILED=1
fi

# Run linter
print_step " Linting your code..."
if npm run lint; then
    print_status "   ✅ Code passes all lint rules!" "$GREEN"
else
    print_status "   ❌ Linting issues found!" "$RED"
    FAILED=1
fi

# Final result
printf "\n"
if [ $FAILED -eq 0 ]; then
    printf "${GREEN}${BOLD}╔════════════════════════════════════════╗${NC}\n"
    printf "${GREEN}${BOLD}║                                        ║${NC}\n"
    printf "${GREEN}${BOLD}║           ALL CHECKS PASSED!           ║${NC}\n"
    printf "${GREEN}${BOLD}║                                        ║${NC}\n"
    printf "${GREEN}${BOLD}║         Ready to commit!               ║${NC}\n"
    printf "${GREEN}${BOLD}║                                        ║${NC}\n"
    printf "${GREEN}${BOLD}╚════════════════════════════════════════╝${NC}\n"
    printf "\n"
    exit 0
else
    printf "${RED}${BOLD}╔════════════════════════════════════════╗${NC}\n"
    printf "${RED}${BOLD}║                                        ║${NC}\n"
    printf "${RED}${BOLD}║         COMMIT BLOCKED ❌              ║${NC}\n"
    printf "${RED}${BOLD}║                                        ║${NC}\n"
    printf "${RED}${BOLD}║     Please fix the issues above       ║${NC}\n"
    printf "${RED}${BOLD}║                                        ║${NC}\n"
    printf "${RED}${BOLD}╚════════════════════════════════════════╝${NC}\n"
    printf "\n"
    exit 1
fi